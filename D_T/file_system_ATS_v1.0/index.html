<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="icon" href="images/icon.svg" />
    <link href="static/static.css" rel="stylesheet" />
    <title>Главная</title>
</head>
<body>
    <div class="wrapper">
        <div class="hamburger-menu">
            <input id="menu__toggle" type="checkbox" />
            <label class="menu__btn" for="menu__toggle">
                <span></span>
            </label>
            <ul class="menu__box">
                <div class="block_status">
                    <div class="block_icon_status">
                        <a href="templates/access-point.html"><img class="icon_status" src="images/access-point.svg" title="Точка доступа" alt=""></a>
                    </div>
                    <div class="block_icon_status">
                        <a href="templates/wi-fi.html"><img class="icon_status" src="images/wi-fi.svg" title="Wi-FI" alt=""></a>
                    </div>
                    <div class="block_icon_status">
                        <a href="templates/ethernet.html"><img class="icon_status" src="images/ethernet.svg" title="Ethernet" alt=""></a>
                    </div>
                </div>
                <li><img class="icon_settings" src="images/home.svg" alt=""><a href="index.html" class="title_menu">Главная</a></li>
                <li><img class="icon_settings" src="images/settings.svg" alt=""><a href="templates/settings.html" class="title_menu">Настройки</a></li>
            </ul>
        </div>
        <div class="container_menu">
            <div class="block_menu">
                <div class="point_menu">
                    <a href="index.html"><img class="icon_settings" src="images/home.svg" alt=""></a>
                    <a href="index.html" class="title_menu_main">Главная</a>
                </div>
                <div class="point_menu">
                    <a href="templates/settings.html"><img class="icon_settings" src="images/settings.svg" alt=""></a>
                    <a href="templates/settings.html" class="title_menu_main">Настройки</a>
                </div>
            </div>
        </div>
        <div class="container_settings_ms wrapper_is">
            <div class="header_body">
                <div class="header_logo">
                    <img class="logo" src="images/logo_w.svg" alt="">
                </div>
            </div>
            <div class="block_status_main_is">
                <div class="block_icon_status">
                    <div class="tooltip_status"><a href="templates/access-point.html"><img class="icon_status" src="images/access-point.svg" alt=""></a>
                        <span class="tooltiptext_status"><span id="ip_conn" style="color: rgb(112, 112, 150);">-</span></span>
                    </div>
                </div>
                <div class="block_icon_status">
                    <div class="tooltip_status"><a href="templates/wi-fi.html"><img class="icon_status" src="images/wi-fi.svg" title="Wi-FI" alt=""></a>
                        <span class="tooltiptext_status"><span id="ip_conn" style="color: rgb(112, 112, 150);">-</span></span>
                    </div>
                </div>
                <div class="block_icon_status">
                    <div class="tooltip_status"><a href="templates/ethernet.html"><img class="icon_status" src="images/ethernet.svg" title="Ethernet" alt=""></a>
                        <span class="tooltiptext_status"><span id="ip_conn" style="color: rgb(112, 112, 150);">-</span></span>
                    </div>
                </div>
            </div>
            <div class="main_title">
                <a class="main_title_text">Схема работы устройства</a>
            </div>
            <div class="container">
                <div class="block_main_settings">
                    <form id="form_index">
                        <div class="block_options_main">
                            <div>
                                <a class="title_options" for="">U1</a>
                                <input type="text" id="input_options" class="in1_u1" style="margin-right: 0px;" value="---" readonly>
                                <a class="title_options" style="margin-left: 10px;" for="">В</a>
                            </div>
                            <div>
                                <a class="title_options" for="">U2</a>
                                <input type="text" id="input_options" class="in1_u2" style="margin-right: 0px;" value="---" readonly>
                                <a class="title_options" style="margin-left: 10px;" for="">В</a>
                            </div>
                            <div>
                                <a class="title_options" for="">U3</a>
                                <input type="text" id="input_options" class="in1_u3" style="margin-right: 0px;" value="---" readonly>
                                <a class="title_options" style="margin-left: 10px;" for="">В</a>
                            </div>
                            <div>
                                <a class="title_options" for="" style="margin-right: 23px;">f</a>
                                <input type="text" id="input_options" class="in1_f1" style="margin-right: 0px;" value="---" readonly>
                                <a class="title_options" for="" style="margin-left: 10px;">Гц</a>
                            </div>
                        </div>
                        <div class="block_scheme">
                            <div class="block_button_radio">
                                <div class="form_radio_btn" style="margin-left: 0px;">
                                    <input type='radio' name='block1' id='r1' checked/>
                                    <label for="r1">Ввод 1</label>
                                </div>
                                <div class="form_radio_btn" style="margin-right: 0px;">
                                    <input type='radio' name='block1' id='r2'/>
                                    <label for="r2">Ввод 2</label>
                                </div>
                            </div>
                            <div class="text">
                                <div class="block_scheme_first">
                                    <div class="block_in">
                                        <img class="icon_in" src="images/in_g.svg" alt="">
                                        <img class="icon_in" src="images/in_r.svg" alt="">
                                    </div>
                                    <img class="index_img" src="images/ats1.svg" alt="">
                                </div>
                            </div>
                            <div class="text" style="display: none;">
                                <div class="block_scheme_second">
                                    <div class="block_in">
                                        <img class="icon_in" src="images/in_r.svg" alt="">
                                        <img class="icon_in" src="images/in_g.svg" alt="">
                                    </div>
                                    <img class="index_img" src="images/ats2.svg" alt="">
                                </div>
                            </div>
                            <div class="block_button_sub">
                                <label class="btn" for="modal-1">Параметры</label>
                                    <div class="modal">
                                        <input class="modal-open" id="modal-1" type="checkbox" hidden>
                                        <div class="modal-wrap" aria-hidden="true" role="dialog">
                                            <label class="modal-overlay" for="modal-1"></label>
                                            <div class="modal-dialog">
                                                <div class="modal-header">
                                                    <h2>Параметры вводов</h2>
                                                    <label class="btn-close" for="modal-1" aria-hidden="true">×</label>
                                                </div>
                                                    <div class="modal-body">
                                                            <div>
                                                                <a class="title_options" for="">U1, B</a>
                                                                <input type="text" id="input_options" class="in1_u1_s" style="margin-right: 0px;" value="---" readonly>
                                                                <input type="text" id="input_options" class="in2_u1_s" style="margin-right: 0px;" value="---" readonly>
                                                            </div>
                                                            <div>
                                                                <a class="title_options" for="">U2, B</a>
                                                                <input type="text" id="input_options" class="in1_u2_s" style="margin-right: 0px;" value="---" readonly>
                                                                <input type="text" id="input_options" class="in2_u2_s" style="margin-right: 0px;" value="---" readonly>
                                                            </div>
                                                            <div>
                                                                <a class="title_options" for="">U3, B</a>
                                                                <input type="text" id="input_options" class="in1_u3_s" style="margin-right: 0px;" value="---" readonly>
                                                                <input type="text" id="input_options" class="in2_u3_s" style="margin-right: 0px;" value="---" readonly>
                                                            </div>
                                                            <div>
                                                                <a class="title_options" for="" style="margin-right: 13px;">f, Гц</a>
                                                                <input type="text" id="input_options" class="in1_f1_s" style="margin-right: 0px;" value="---" readonly>
                                                                <input type="text" id="input_options" class="in2_f1_s" style="margin-right: 0px;" value="---" readonly>
                                                            </div>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                        <div class="block_options_main">
                            <div>
                                <a class="title_options" for="">U1</a>
                                <input type="text" id="input_options" class="in2_u1" style="margin-right: 0px;" value="---" readonly>
                                <a class="title_options" style="margin-left: 10px;" for="">В</a>
                            </div>
                            <div>
                                <a class="title_options" for="">U2</a>
                                <input type="text" id="input_options" class="in2_u2" style="margin-right: 0px;" value="---" readonly>
                                <a class="title_options" style="margin-left: 10px;" for="">В</a>
                            </div>
                            <div>
                                <a class="title_options" for="">U3</a>
                                <input type="text" id="input_options" class="in2_u3" style="margin-right: 0px;" value="---" readonly>
                                <a class="title_options" style="margin-left: 10px;" for="">В</a>
                            </div>
                            <div>
                                <a class="title_options" for="" style="margin-right: 23px;">f</a>
                                <input type="text" id="input_options" class="in2_f1" style="margin-right: 0px;" value="---" readonly>
                                <a class="title_options" for="" style="margin-left: 10px;">Гц</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        const PATH_FOR_UPLOAD = "/api/getStrData.api";
        //const PATH_FOR_UPLOAD = "api/getStrData.json"

        function docReady(fn) {
            if (document.readyState === "complete" || document.readyState === "interactive") {
                setTimeout(fn, 1);
            } else {
                document.addEventListener("DOMContentLoaded", fn);
            }
        };

        // функция выполняет запрос к конфигурационному файлу
        function getJSONfromDevice(PATH_FOR_UPLOAD, callback){
            var xhr = new XMLHttpRequest();
            xhr.open('GET', PATH_FOR_UPLOAD, true);
            xhr.responseType = 'json';
            xhr.onload = function() {
                var status = xhr.status;
                if (status === 200) {
                    callback(null, xhr.response);
                } else {
                    callback(status, xhr.response);
                }
            };
            xhr.send();
        };

        const findOne = (element, selector) => element.querySelector(selector)
        const C = findOne(document.body, ".block_main_settings");
        const Q = findOne(C, "#form_index");

        function CallBackFunction(err, PATH_FOR_UPLOAD){
            if(err){
                //Error!
            }else{
                form_obj = PATH_FOR_UPLOAD;
                console.log(form_obj);

                findOne(Q, ".in1_u1").value = form_obj.Inputs.Input1.L1.U;
                findOne(Q, ".in1_u2").value = form_obj.Inputs.Input1.L2.U;
                findOne(Q, ".in1_u3").value = form_obj.Inputs.Input1.L3.U;

                findOne(Q, ".in1_u1_s").value = findOne(Q, ".in1_u1").value;
                findOne(Q, ".in1_u2_s").value = findOne(Q, ".in1_u2").value;
                findOne(Q, ".in1_u3_s").value = findOne(Q, ".in1_u3").value;

                let in1_f1_1 = form_obj.Inputs.Input1.L1.F;
                let in1_f1_2 = form_obj.Inputs.Input1.L2.F;
                let in1_f1_3 = form_obj.Inputs.Input1.L3.F;

                if(in1_f1_1 > 0){
                    findOne(Q, ".in1_f1").value = in1_f1_1;
                    findOne(Q, ".in1_f1_s").value = findOne(Q, ".in1_f1").value;
                } else if(in1_f1_2 > 0){
                    findOne(Q, ".in1_f1").value = in1_f1_2;
                    findOne(Q, ".in1_f1_s").value = findOne(Q, ".in1_f1").value;
                } else if(in1_f1_3 > 0){
                    findOne(Q, ".in1_f1").value = in1_f1_3;
                    findOne(Q, ".in1_f1_s").value = findOne(Q, ".in1_f1").value;
                }

                findOne(Q, ".in2_u1").value = form_obj.Inputs.Input2.L1.U;
                findOne(Q, ".in2_u2").value = form_obj.Inputs.Input2.L2.U;
                findOne(Q, ".in2_u3").value = form_obj.Inputs.Input2.L3.U;

                findOne(Q, ".in2_u1_s").value = findOne(Q, ".in2_u1").value;
                findOne(Q, ".in2_u2_s").value = findOne(Q, ".in2_u2").value;
                findOne(Q, ".in2_u3_s").value = findOne(Q, ".in2_u3").value;
                
                let in2_f1_1 = form_obj.Inputs.Input2.L1.F;
                let in2_f1_2 = form_obj.Inputs.Input2.L2.F;
                let in2_f1_3 = form_obj.Inputs.Input2.L3.F;

                if(in2_f1_1 > 0){
                    findOne(Q, ".in2_f1").value = in2_f1_1;
                    findOne(Q, ".in2_f1_s").value = findOne(Q, ".in2_f1").value;
                } else if(in2_f1_2 > 0){
                    findOne(Q, ".in2_f1").value = in2_f1_2;
                    findOne(Q, ".in2_f1_s").value = findOne(Q, ".in2_f1").value;
                } else if(in2_f1_3 > 0){
                    findOne(Q, ".in2_f1").value = in2_f1_3;
                    findOne(Q, ".in2_f1_s").value = findOne(Q, ".in2_f1").value;
                }

            }
        };

        docReady(function() {
            getJSONfromDevice(PATH_FOR_UPLOAD, CallBackFunction);
            setInterval(function(){
                console.clear();
                getJSONfromDevice(PATH_FOR_UPLOAD, CallBackFunction);
            }, 5000);
            //window.onload = getJSONfromDevice(PATH_FOR_UPLOAD, CallBackFunction);
        });

        var radio = document.getElementsByClassName('text'); 
        var click = [];
        for (i=1; i<= radio.length; i++) {
            click[i]= document.getElementById('r' + i);
        }
        function clicking (click) {
        click.onclick=function() {Go()}; }
        function display (click, radio) {
            if (click.checked) {radio.style.display = 'block';} else {radio.style.display = 'none'; }
        }
        for (i=1; i<= radio.length; i++) {
            clicking (click[i]);
        }
        function Go () {
            for (i=1; i<= radio.length; i++) {
                display (click[i], radio[i-1]);
            }
        }
        /*
        // страница обновляется каждые 10с для перезаписи данных 
        setTimeout(function(){
            location.reload();
        }, 10000);
        */
    </script>
</body>